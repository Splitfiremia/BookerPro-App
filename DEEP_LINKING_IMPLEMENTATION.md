# Deep Linking Implementation Guide\n\n## Overview\n\nThe deep linking system allows users to open the mobile app directly from shop websites with the \"Book Now\" button. This creates a seamless experience from website to app booking.\n\n## Configuration\n\n### App Configuration (app.json)\n\nThe app needs to be configured with the custom URL scheme:\n\n```json\n{\n  \"expo\": {\n    \"scheme\": \"bookerpro\"\n  }\n}\n```\n\n**Note**: The current app.json uses \"myapp\" as the scheme. This should be changed to \"bookerpro\" for production.\n\n## URL Structure\n\n### Basic Format\n```\nbookerpro://shop/[shopSlug]?[parameters]\n```\n\n### Examples\n\n1. **Basic shop view**:\n   ```\n   bookerpro://shop/demoshop\n   ```\n\n2. **Book appointment**:\n   ```\n   bookerpro://shop/demoshop?action=book\n   ```\n\n3. **Book with specific provider**:\n   ```\n   bookerpro://shop/demoshop?action=book&providerId=123\n   ```\n\n4. **Pre-filled booking**:\n   ```\n   bookerpro://shop/demoshop?action=book&providerId=123&serviceId=456&date=2024-03-15&time=14:00\n   ```\n\n5. **With analytics tracking**:\n   ```\n   bookerpro://shop/demoshop?action=book&utm_source=website&utm_medium=button&utm_campaign=hero_cta\n   ```\n\n## Parameters\n\n| Parameter | Type | Description | Example |\n|-----------|------|-------------|----------|\n| `shopSlug` | string | Unique shop identifier | `demoshop` |\n| `action` | string | Action to perform: `view`, `book`, `contact`, `services`, `portfolio`, `reviews` | `book` |\n| `providerId` | string | Specific provider ID | `123` |\n| `serviceId` | string | Specific service ID | `456` |\n| `date` | string | Pre-fill date (YYYY-MM-DD) | `2024-03-15` |\n| `time` | string | Pre-fill time (HH:MM) | `14:00` |\n| `utm_source` | string | Analytics source | `website` |\n| `utm_medium` | string | Analytics medium | `button` |\n| `utm_campaign` | string | Analytics campaign | `hero_cta` |\n\n## Navigation Flow\n\nWhen a deep link is opened, the app:\n\n1. **Parses the URL** using `DeepLinkParser`\n2. **Validates parameters** (shop slug, action, etc.)\n3. **Navigates to appropriate screen**:\n   - Shop view: `/(app)/(client)/shops/[shopSlug]`\n   - Provider booking: `/(app)/(client)/provider/[providerId]`\n   - Service booking: `/(app)/(client)/booking/select-service`\n4. **Tracks analytics** if UTM parameters are present\n\n## Implementation Files\n\n### Core Files\n- `models/deepLinking.ts` - Deep link configuration and utilities\n- `utils/deepLinkHandler.ts` - Main deep link handling logic\n- `app/_layout.tsx` - Initialization in root layout\n\n### Key Components\n- `DeepLinkHandler` - Main handler class\n- `DeepLinkParser` - URL parsing logic\n- `DeepLinkGenerator` - URL generation for websites\n\n## Testing\n\n### Manual Testing\n\nYou can test deep links by:\n\n1. **Console testing**:\n   ```javascript\n   import { testDeepLink } from '@/utils/deepLinkHandler';\n   testDeepLink('bookerpro://shop/demoshop?action=book');\n   ```\n\n2. **Device testing** (iOS/Android):\n   - Open Safari/Chrome\n   - Type the deep link URL in address bar\n   - App should open and navigate to correct screen\n\n3. **Simulator testing**:\n   ```bash\n   # iOS Simulator\n   xcrun simctl openurl booted \"bookerpro://shop/demoshop?action=book\"\n   \n   # Android Emulator\n   adb shell am start -W -a android.intent.action.VIEW -d \"bookerpro://shop/demoshop?action=book\"\n   ```\n\n### Example Test URLs\n\n```javascript\nconst testUrls = {\n  shopView: 'bookerpro://shop/demoshop',\n  bookAppointment: 'bookerpro://shop/demoshop?action=book',\n  bookWithProvider: 'bookerpro://shop/demoshop?action=book&providerId=123',\n  preFilledBooking: 'bookerpro://shop/demoshop?action=book&providerId=123&serviceId=456&date=2024-03-15&time=14:00',\n  withAnalytics: 'bookerpro://shop/demoshop?action=book&utm_source=website&utm_medium=button&utm_campaign=hero_cta'\n};\n```\n\n## Website Integration\n\n### HTML Button Example\n\n```html\n<!-- Basic Book Now button -->\n<a href=\"bookerpro://shop/{{shopSlug}}?action=book&utm_source=website&utm_medium=button&utm_campaign=hero_cta\">\n  Book Now\n</a>\n\n<!-- With fallback to app store -->\n<a href=\"bookerpro://shop/{{shopSlug}}?action=book\" \n   onclick=\"setTimeout(function() { \n     window.location = 'https://apps.apple.com/app/bookerpro/id123456789'; \n   }, 1000);\">\n  Book Now\n</a>\n```\n\n### JavaScript Smart Link\n\n```javascript\nfunction generateSmartLink(shopSlug, action = 'book') {\n  const deepLink = `bookerpro://shop/${shopSlug}?action=${action}&utm_source=website&utm_medium=button&utm_campaign=hero_cta`;\n  const fallbackUrl = `https://bookerpro.com/${shopSlug}`;\n  \n  // Try to open deep link, fallback to web after timeout\n  window.location = deepLink;\n  setTimeout(() => {\n    window.location = fallbackUrl;\n  }, 1000);\n}\n```\n\n## Fallback Handling\n\n### App Not Installed\n\nWhen the app is not installed, the website should:\n\n1. **Detect platform** (iOS/Android)\n2. **Redirect to app store**:\n   - iOS: `https://apps.apple.com/app/bookerpro/id123456789`\n   - Android: `https://play.google.com/store/apps/details?id=com.bookerpro.app`\n\n### Universal Links (Future Enhancement)\n\nFor better user experience, implement Universal Links (iOS) and App Links (Android):\n\n- **iOS**: `https://bookerpro.com/app/shop/demoshop`\n- **Android**: `https://bookerpro.com/app/shop/demoshop`\n\nThese URLs work both as web links and app deep links.\n\n## Analytics Tracking\n\nThe system tracks:\n\n- **Deep link opens** with UTM parameters\n- **Navigation success/failure**\n- **Conversion to bookings**\n\nExample tracking data:\n```javascript\n{\n  event: 'deep_link_opened',\n  shop_slug: 'demoshop',\n  action: 'book',\n  utm_source: 'website',\n  utm_medium: 'button',\n  utm_campaign: 'hero_cta',\n  timestamp: '2024-03-15T14:30:00Z'\n}\n```\n\n## Security Considerations\n\n1. **URL Validation**: All URLs are validated before processing\n2. **Parameter Sanitization**: Input parameters are sanitized\n3. **Length Limits**: URLs are limited to 2000 characters\n4. **Shop Verification**: Shop slugs should be verified against database\n\n## Troubleshooting\n\n### Common Issues\n\n1. **App doesn't open**:\n   - Check URL scheme in app.json\n   - Verify app is installed\n   - Test on physical device (simulators may have issues)\n\n2. **Wrong screen opens**:\n   - Check URL parameters\n   - Verify navigation paths in `deepLinkHandler.ts`\n   - Check console logs for parsing errors\n\n3. **Analytics not tracking**:\n   - Verify UTM parameters in URL\n   - Check analytics service integration\n   - Review console logs for tracking calls\n\n### Debug Logs\n\nThe system provides detailed console logs:\n\n```\nDeepLinkHandler: Processing deep link: bookerpro://shop/demoshop?action=book\nDeepLinkHandler: Parsed params: {shopSlug: \"demoshop\", action: \"book\"}\nDeepLinkHandler: Navigating to: /(app)/(client)/shops/demoshop?action=book\nDeepLinkHandler: Tracking deep link open: {shopSlug: \"demoshop\", action: \"book\"}\n```\n\n## Production Checklist\n\n- [ ] Update app.json scheme to \"bookerpro\"\n- [ ] Test deep links on iOS and Android devices\n- [ ] Verify all navigation paths work correctly\n- [ ] Set up app store fallback URLs\n- [ ] Configure analytics tracking\n- [ ] Test with various URL parameters\n- [ ] Verify security validations\n- [ ] Update website templates with correct deep links\n\n## Future Enhancements\n\n1. **Universal Links / App Links** for better user experience\n2. **QR Code generation** for easy sharing\n3. **Dynamic link shortening** for social media\n4. **A/B testing** for different call-to-action buttons\n5. **Advanced analytics** with conversion tracking